# config/config.yaml

Dataset:
  train_set_file: /content/drive/MyDrive/Data/GPDSmanosASM_txt/train_palma.txt
  test_set_file: /content/drive/MyDrive/Data/GPDSmanosASM_txt/test_palma.txt
  height: 128
  width: 128
  channels: 1
  augmentation: true
  negative_samples_file: /content/drive/MyDrive/CCNet_OKD_CD/data/train_Tongji.txt
  num_negative_classes: 100

Model:
  architecture: ccnet
  competition_weight: 0.8
  use_pretrained: true
  pretrained_path: /content/drive/MyDrive/net_params1.pth
  # 🧀 프로젝션 헤드 설정
  projection_dim: 512
  use_projection: true

Training:
  scr_batch_size: 18
  memory_batch_size: 110
  num_experiences: 100
  memory_size: 1000
  min_samples_per_class: 9
  scr_epochs: 5
  iterations_per_epoch: 10
  num_epochs: 3000  # (사용 안 함)
  num_workers: 8
  learning_rate: 0.0001
  scheduler_step_size: 50
  scheduler_gamma: 0.8
  temperature: 0.07  # SupConLoss용
  save_interval: 1000  # (사용 안 함)
  test_interval: 5  # ⭐ 평가 및 캘리브레이션 주기
  checkpoint_path: /content/drive/MyDrive/cvc
  results_path: /content/drive/MyDrive/cvc
  gpu_ids: "0"
  ncm_momentum: 1.0
  seed: 42  # 🥩 추가!


  # 🦈 ProxyAnchorLoss 설정 추가
  use_proxy_anchor: true
  proxy_margin: 0.5        # Proxy Anchor margin δ
  proxy_alpha: 64          # Proxy Anchor scaling α
  proxy_lr_ratio: 1       # 프록시 학습률 배수 (백본의 10배)
  proxy_lambda: 0.5        # 🦈 고정 가중치 (0.3 = 30% ProxyAnchor, 70% SupCon)

# 🐋 오픈셋 인식 설정
Openset:
  enabled: true

  # ☄️ 임계치 설정
  threshold_mode: 'far'      # 'eer' or 'far'
  target_far: 0.01           # FAR 타겟 1%
  threshold_alpha: 1.0       # EMA 스무딩 계수
  threshold_max_delta: 1.0  # 최대 변화폭
  
  # 초기값 및 워밍업
  warmup_users: 10           # 워밍업 기간
  initial_tau: 0.5           # 초기 임계치
  
  # 데이터 분할
  dev_ratio: 0.1             # Dev 세트 비율
  negref_max_eval: 100      # NegRef 최대 샘플
  
  # 로깅
  verbose_calibration: true  # 상세 출력

  # 🥩 TTA 설정 (Test-Time Augmentation)
  tta_n_views: 3  # 1=비활성, 2~3 권장
  tta_include_original: true  # 원본 포함 권장
  tta_agree_k: 0  # 0=과반 자동, 2=2개 이상 동의
  tta_augmentation_strength: 1.0  # 0.3~0.7 권장
  tta_aggregation: 'mean'  # 'median' or 'mean'
  
  # 🪻 기존 TTA 반복 설정
  # tta_n_repeats: 3  # TTA 반복 횟수
  
  # 🎾 타입별 독립적인 TTA 반복 설정
  tta_n_repeats_genuine: 2      # Genuine 점수: 3번 반복 (정확도 중요)
  tta_n_repeats_between: 2      # Between impostor: 2번 반복 (균형)
  tta_n_repeats_negref: 0       # NegRef: 1번 (메모리 절약)
  tta_repeat_aggregation: 'mean'  # 반복 간 집계 방법
  tta_verbose: true  # TTA 디버깅 출력
  
  # 🎾 Impostor 점수 비율 설정 (합이 1.0이 되어야 함)
  impostor_ratio_between: 1.0    # Between impostor 30%
  impostor_ratio_unknown: 0.0    # Unknown 0% (현재 미사용)
  impostor_ratio_negref: 0.0     # NegRef 70%
  impostor_balance_total: 6000   # 균형 맞출 총 샘플 수

# 🔥 네거티브 샘플 설정
Negative:
  warmup_experiences: 4
  max_per_batch: 1
  r0: 0.5
