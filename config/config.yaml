# 🐋 config/config.yaml (정리 버전)

Dataset:
  train_set_file: /content/drive/MyDrive/Data/GPDSmanosASM_txt/train_palma.txt
  test_set_file: /content/drive/MyDrive/Data/GPDSmanosASM_txt/test_palma.txt
  height: 128
  width: 128
  channels: 1
  augmentation: true
  negative_samples_file: /content/drive/MyDrive/CCNet_OKD_CD/data/train_Tongji.txt
  num_negative_classes: 10

Model:
  architecture: ccnet
  competition_weight: 0.8
  use_pretrained: true
  pretrained_path: /content/drive/MyDrive/net_params1.pth
  # 🧀 프로젝션 헤드 설정
  use_projection: true
  projection_dim: 128

Training:
  scr_batch_size: 10
  memory_batch_size: 16
  num_experiences: 100
  memory_size: 1000
  min_samples_per_class: 15
  scr_epochs: 3
  iterations_per_epoch: 15
  num_epochs: 3000  # (사용 안 함)
  num_workers: 8
  learning_rate: 0.0001
  scheduler_step_size: 50
  scheduler_gamma: 0.8
  temperature: 0.07  # SupConLoss용
  save_interval: 1000  # (사용 안 함)
  test_interval: 5  # ⭐ 평가 및 캘리브레이션 주기
  checkpoint_path: /content/drive/MyDrive/scr_proxy
  results_path: /content/drive/MyDrive/scr_proxy
  gpu_ids: "0"
  ncm_momentum: 0.9
  
  # 💎 ProxyContrastLoss 설정 (NEW!)
  use_proxy_loss: true
  proxy_lambda: 0.3  # 손실 가중치
  proxy_temperature: 0.15  # SupCon(0.07)보다 높게!
  proxy_topk: 30  # Top-K 클래스
  proxy_full_until: 100  # 100개 이하면 전체 사용
  proxy_warmup_classes: 5  # 최소 클래스 수
  
  # 💎 Lambda 스케줄링 (점진적 증가)
  proxy_lambda_schedule:
    warmup: 0.1      # warmup 직후
    warmup_10: 0.2   # warmup + 10 exp
    warmup_20: 0.3   # warmup + 20 exp
  
  # 💎 커버리지 샘플링
  use_coverage_sampling: true
  coverage_k_per_class: 2  # 클래스당 샘플 수
  
  # 💎 프로토타입 설정
  prototype_beta: 0.05  # EMA 계수 (미래 확장용)

# 🐋 오픈셋 인식 설정 (정리)
Openset:
  enabled: true

  # ☄️ 임계치 설정 (통합)
  threshold_mode: 'far'      # ☄️ 'eer' or 'far'
  target_far: 0.01           # ☄️ FAR 타겟 1%
  threshold_alpha: 0.2       # ☄️ EMA 스무딩 계수 (기존 smoothing_alpha 대체)
  threshold_max_delta: 0.03  # ☄️ 최대 변화폭 (기존 max_delta 대체)
  
  # 초기값 및 워밍업
  warmup_users: 10           # 워밍업 기간
  initial_tau: 0.9           # 초기 임계치
  
  # 마진 규칙
  use_margin: false
  margin_tau: 0.07
  
  # 데이터 분할
  dev_ratio: 0.3             # Dev 세트 비율
  negref_max_eval: 5000      # NegRef 최대 샘플
  
  # 로깅
  verbose_calibration: true  # ☄️ 상세 출력

# 🔥 네거티브 샘플 설정
Negative:
  warmup_experiences: 4
  max_per_batch: 1
  r0: 0.5