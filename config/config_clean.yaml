# COCONUT Configuration
# Compact Online Continual Neural User Templates

Dataset:
  train_set_file: /content/drive/MyDrive/Data/GPDSmanosASM_txt/train_palma.txt
  test_set_file: /content/drive/MyDrive/Data/GPDSmanosASM_txt/test_palma.txt
  negative_samples_file: /content/drive/MyDrive/CCNet_OKD_CD/data/train_Tongji.txt
  height: 128
  width: 128
  channels: 1
  augmentation: true
  num_negative_classes: 100

Model:
  architecture: ccnet
  competition_weight: 0.8
  use_pretrained: true
  pretrained_path: /content/drive/MyDrive/net_params1.pth
  # Projection head configuration
  projection_dim: 512
  use_projection: true

Training:
  # Batch sizes
  scr_batch_size: 18
  memory_batch_size: 110

  # Continual learning parameters
  num_experiences: 100
  memory_size: 1000
  min_samples_per_class: 9

  # Training iterations
  scr_epochs: 5
  iterations_per_epoch: 10

  # Learning rates
  learning_rate: 0.0001
  projection_learning_rate: 0.0005  # 5x backbone LR

  # Scheduler
  scheduler_step_size: 50
  scheduler_gamma: 0.8

  # Loss parameters
  temperature: 0.07  # SupConLoss temperature

  # ProxyAnchorLoss configuration
  use_proxy_anchor: true
  proxy_margin: 0.5        # Margin delta
  proxy_alpha: 64          # Scaling alpha
  proxy_lr_ratio: 1        # Proxy learning rate multiplier
  proxy_lambda: 0.5        # Weight: 50% ProxyAnchor, 50% SupCon

  # System settings
  num_workers: 8
  gpu_ids: "0"
  seed: 42

  # Paths
  checkpoint_path: /content/drive/MyDrive/cvc
  results_path: /content/drive/MyDrive/cvc

  # Evaluation
  test_interval: 5  # Evaluate every N experiences
  ncm_momentum: 1.0

# Open-set Recognition
Openset:
  enabled: true

  # Threshold calibration
  threshold_mode: 'far'      # 'eer' or 'far'
  target_far: 0.01           # Target FAR: 1%
  threshold_alpha: 1.0       # EMA smoothing coefficient
  threshold_max_delta: 1.0   # Maximum change per update

  # Initialization
  warmup_users: 10
  initial_tau: 0.5

  # Data splitting
  dev_ratio: 0.1
  negref_max_eval: 100

  # TTA (Test-Time Augmentation)
  tta_n_views: 3             # Number of augmented views
  tta_include_original: true
  tta_agree_k: 0             # 0 = majority voting
  tta_augmentation_strength: 1.0
  tta_aggregation: 'mean'

  # Type-specific TTA repetitions
  tta_n_repeats_genuine: 2   # Genuine score repetitions
  tta_n_repeats_between: 2   # Between-class impostor repetitions
  tta_n_repeats_negref: 0    # Negative reference repetitions (disabled)
  tta_repeat_aggregation: 'mean'
  tta_verbose: true

  # Impostor score balancing
  impostor_ratio_between: 1.0    # 100% between-class impostors
  impostor_ratio_unknown: 0.0    # 0% unknown (not used)
  impostor_ratio_negref: 0.0     # 0% negative references (disabled)
  impostor_balance_total: 6000

  verbose_calibration: true

# Negative Sample Configuration
Negative:
  warmup_experiences: 4  # Use negatives for first 4 experiences
  max_per_batch: 1
  r0: 0.5